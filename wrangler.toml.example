name = "matrix-chatgpt-bot"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Public environment variables (can be in version control)
[vars]
MATRIX_HOMESERVER = "https://matrix.org"

# KV Namespace Configuration
# IMPORTANT: The binding name must be "KV" (not your namespace name)
# Run: wrangler kv:namespace create "KV" to get your production ID
# Run: wrangler kv:namespace create "KV" --preview to get your preview ID
[[kv_namespaces]]
binding = "KV"
id = "YOUR_KV_NAMESPACE_ID_HERE"
preview_id = "YOUR_PREVIEW_KV_NAMESPACE_ID_HERE"

# R2 Bucket Configuration
# Run: wrangler r2 bucket create matrix-bot-storage
# Run: wrangler r2 bucket create matrix-bot-storage-preview
[[r2_buckets]]
binding = "R2"
bucket_name = "matrix-bot-storage"
preview_bucket_name = "matrix-bot-storage-preview"

# Durable Objects Configuration (no changes needed)
[[durable_objects.bindings]]
name = "MATRIX_SYNC"
class_name = "MatrixSync"
script_name = "matrix-chatgpt-bot"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["MatrixSync"]

# Scheduled triggers (runs sync every 2 minutes)
[triggers]
crons = ["*/2 * * * *"]

# Secrets (DO NOT put actual values here, use: wrangler secret put <KEY>)
# Required secrets:
# - MATRIX_USER_ID: Your Matrix bot user ID (e.g., @botuser:matrix.org)
# - MATRIX_PASSWORD: Your Matrix bot password
# - OPENAI_API_KEY: Your OpenAI API key (or compatible API key)
# - OPENAI_BASE_URL: (Optional) Custom API endpoint (default: https://api.openai.com/v1)
# - BOT_ADMIN_USERS: (Optional) Comma-separated list of admin users
# - DEFAULT_MODEL: (Optional) Default AI model (default: gpt-4)
